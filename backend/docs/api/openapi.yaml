openapi: 3.1.0
info:
  title: FallHelp API
  description: API Documentation for FallHelp - Fall Detection and Monitoring System for Elderly Care
  version: 1.0.0
servers:
  - url: http://localhost:3000/api
    description: Local development server
  - url: https://api.fallhelp.com/api
    description: Production server
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    Error:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          example: Error message
    Success:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
security:
  - bearerAuth: []
tags:
  - name: Health
    description: Health check endpoint
  - name: Auth
    description: Authentication and authorization
  - name: Users
    description: User profile management
  - name: Elders
    description: Elder management
  - name: Devices
    description: IoT device management
  - name: Events
    description: Fall detection and heart rate events
  - name: Emergency Contacts
    description: Emergency contact management
  - name: Feedback
    description: User feedback and suggestions
  - name: Notifications
    description: Notification management
  - name: Admin
    description: Admin dashboard and management
paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Check if the API is running
      security: []
      responses:
        "200":
          description: API is running successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: FallHelp API is running
                  timestamp:
                    type: string
                    format: date-time
  /auth/register:
    post:
      tags:
        - Auth
      summary: Register new user
      description: Create a new user account
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
                - firstName
                - lastName
                - phone
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  minLength: 8
                firstName:
                  type: string
                lastName:
                  type: string
                phone:
                  type: string
      responses:
        "201":
          description: User registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      userId:
                        type: string
                      email:
                        type: string
                      token:
                        type: string
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /auth/login:
    post:
      tags:
        - Auth
      summary: Login
      description: Authenticate user and get JWT token
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      token:
                        type: string
                      user:
                        type: object
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /auth/request-otp:
    post:
      tags:
        - Auth
      summary: Request OTP
      description: Request OTP for password reset or email verification
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - purpose
              properties:
                email:
                  type: string
                  format: email
                purpose:
                  type: string
                  enum: [PASSWORD_RESET, EMAIL_VERIFICATION]
      responses:
        "200":
          description: OTP sent successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"
  /auth/verify-otp:
    post:
      tags:
        - Auth
      summary: Verify OTP
      description: Verify OTP code
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - code
                - purpose
              properties:
                email:
                  type: string
                code:
                  type: string
                purpose:
                  type: string
      responses:
        "200":
          description: OTP verified successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"
  /auth/reset-password:
    post:
      tags:
        - Auth
      summary: Reset password
      description: Reset password using OTP
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - code
                - newPassword
              properties:
                email:
                  type: string
                code:
                  type: string
                newPassword:
                  type: string
      responses:
        "200":
          description: Password reset successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"
  /auth/me:
    get:
      tags:
        - Auth
      summary: Get current user
      description: Get authenticated user information
      responses:
        "200":
          description: User information retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
  /users/profile:
    get:
      tags:
        - Users
      summary: Get user profile
      description: Get current user profile
      responses:
        "200":
          description: Profile retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
    put:
      tags:
        - Users
      summary: Update user profile
      description: Update current user profile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                firstName:
                  type: string
                lastName:
                  type: string
                phone:
                  type: string
      responses:
        "200":
          description: Profile updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"
  /users/password:
    put:
      tags:
        - Users
      summary: Change password
      description: Change user password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - currentPassword
                - newPassword
              properties:
                currentPassword:
                  type: string
                newPassword:
                  type: string
      responses:
        "200":
          description: Password changed successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"
  /users/push-token:
    put:
      tags:
        - Users
      summary: Update push token
      description: Update Expo Push Token for push notifications
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - pushToken
              properties:
                pushToken:
                  type: string
                  description: Expo Push Token (format ExponentPushToken[...])
      responses:
        "200":
          description: Push token updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"
  /users/elders:
    get:
      tags:
        - Users
      summary: Get user's elders
      description: Get all elders managed by current user
      responses:
        "200":
          description: Elders retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      type: object
  /elders:
    post:
      tags:
        - Elders
      summary: Create elder
      description: Create a new elder profile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - firstName
                - lastName
                - dateOfBirth
              properties:
                firstName:
                  type: string
                lastName:
                  type: string
                gender:
                  type: string
                  enum: [MALE, FEMALE, OTHER]
                dateOfBirth:
                  type: string
                  format: date
                height:
                  type: number
                weight:
                  type: number
                diseases:
                  type: array
                  items:
                    type: string
                address:
                  type: string
      responses:
        "201":
          description: Elder created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
    get:
      tags:
        - Elders
      summary: Get all elders
      description: Get all elders for current user
      responses:
        "200":
          description: Elders retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      type: object
  /elders/{elderId}:
    get:
      tags:
        - Elders
      summary: Get elder by ID
      description: Get elder details by ID
      parameters:
        - name: elderId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Elder retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
    put:
      tags:
        - Elders
      summary: Update elder
      description: Update elder information
      parameters:
        - name: elderId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                firstName:
                  type: string
                lastName:
                  type: string
                address:
                  type: string
      responses:
        "200":
          description: Elder updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"
  /elders/{elderId}/deactivate:
    patch:
      tags:
        - Elders
      summary: Deactivate elder
      description: Deactivate elder profile
      parameters:
        - name: elderId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Elder deactivated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"
  /devices/qr/{deviceCode}:
    get:
      tags:
        - Devices
      summary: Get device QR code
      description: Get QR code for device pairing
      security: []
      parameters:
        - name: deviceCode
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: QR code retrieved successfully
          content:
            image/png:
              schema:
                type: string
                format: binary
  /devices/pair:
    post:
      tags:
        - Devices
      summary: Pair device
      description: Pair device to elder
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - deviceCode
                - elderId
              properties:
                deviceCode:
                  type: string
                elderId:
                  type: string
      responses:
        "200":
          description: Device paired successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"
  /devices/{deviceId}/unpair:
    delete:
      tags:
        - Devices
      summary: Unpair device
      description: Unpair device from elder
      parameters:
        - name: deviceId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Device unpaired successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"
  /events:
    get:
      tags:
        - Events
      summary: Get events
      description: Get all events with pagination
      parameters:
        - name: elderId
          in: query
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
      responses:
        "200":
          description: Events retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      type: object
                  pagination:
                    type: object
  /events/recent:
    get:
      tags:
        - Events
      summary: Get recent events
      description: Get recent events
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 5
      responses:
        "200":
          description: Recent events retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      type: object
  /events/stats/daily:
    get:
      tags:
        - Events
      summary: Get daily statistics
      description: Get daily event statistics for the last N days
      parameters:
        - name: elderId
          in: query
          schema:
            type: string
          description: Filter by elder ID
        - name: days
          in: query
          schema:
            type: integer
            default: 7
          description: Number of days to retrieve (default 7)
      responses:
        "200":
          description: Daily statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      type: object
  /events/stats/monthly:
    get:
      tags:
        - Events
      summary: Get monthly statistics
      description: Get monthly event statistics for a specific year and month
      parameters:
        - name: elderId
          in: query
          schema:
            type: string
          description: Filter by elder ID
        - name: year
          in: query
          required: true
          schema:
            type: integer
          description: Year for statistics
        - name: month
          in: query
          required: true
          schema:
            type: integer
            minimum: 1
            maximum: 12
          description: Month for statistics (1-12)
      responses:
        "200":
          description: Monthly statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
  /events/{eventId}:
    get:
      tags:
        - Events
      summary: Get event by ID
      description: Get event details by ID
      parameters:
        - name: eventId
          in: path
          required: true
          schema:
            type: string
        - name: timestamp
          in: query
          required: true
          schema:
            type: string
            format: date-time
      responses:
        "200":
          description: Event retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
  /events/{eventId}/cancel:
    post:
      tags:
        - Events
      summary: Cancel event
      description: Cancel false alarm event
      parameters:
        - name: eventId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - timestamp
              properties:
                timestamp:
                  type: string
                  format: date-time
      responses:
        "200":
          description: Event cancelled successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"
  /notifications:
    get:
      tags:
        - Notifications
      summary: List notifications
      description: Get paginated list of notifications
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: pageSize
          in: query
          schema:
            type: integer
            default: 20
        - name: isRead
          in: query
          schema:
            type: boolean
      responses:
        "200":
          description: Notifications retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      type: object
                  pagination:
                    type: object
    delete:
      tags:
        - Notifications
      summary: Clear all notifications
      description: Delete all notifications for current user
      responses:
        "200":
          description: Notifications cleared successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"
  /notifications/unread-count:
    get:
      tags:
        - Notifications
      summary: Get unread count
      description: Get number of unread notifications
      responses:
        "200":
          description: Count retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  count:
                    type: integer
  /notifications/{id}/read:
    patch:
      tags:
        - Notifications
      summary: Mark as read
      description: Mark a specific notification as read
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Marked as read successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"
  /notifications/read-all:
    patch:
      tags:
        - Notifications
      summary: Mark all as read
      description: Mark all notifications as read
      responses:
        "200":
          description: Marked all as read successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"
  /elders/{elderId}/emergency-contacts:
    get:
      tags:
        - Emergency Contacts
      summary: Get emergency contacts
      description: Get all emergency contacts for elder
      parameters:
        - name: elderId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Emergency contacts retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      type: object
    post:
      tags:
        - Emergency Contacts
      summary: Create emergency contact
      description: Create new emergency contact for elder
      parameters:
        - name: elderId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - phone
                - relationship
                - priority
              properties:
                name:
                  type: string
                phone:
                  type: string
                relationship:
                  type: string
                priority:
                  type: integer
      responses:
        "201":
          description: Emergency contact created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
  /emergency-contacts/{contactId}:
    put:
      tags:
        - Emergency Contacts
      summary: Update emergency contact
      description: Update emergency contact information
      parameters:
        - name: contactId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                phone:
                  type: string
                priority:
                  type: integer
      responses:
        "200":
          description: Emergency contact updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"
    delete:
      tags:
        - Emergency Contacts
      summary: Delete emergency contact
      description: Delete emergency contact
      parameters:
        - name: contactId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Emergency contact deleted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"
  /admin/dashboard:
    get:
      tags:
        - Admin
      summary: Get admin dashboard
      description: Get admin dashboard statistics
      responses:
        "200":
          description: Dashboard data retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
  /admin/devices:
    get:
      tags:
        - Admin
      summary: Get all devices
      description: Get all devices (admin only)
      responses:
        "200":
          description: Devices retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      type: object
    post:
      tags:
        - Admin
      summary: Create device
      description: Create new device (admin only)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - serialNumber
                - firmwareVersion
              properties:
                serialNumber:
                  type: string
                firmwareVersion:
                  type: string
      responses:
        "201":
          description: Device created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
  /admin/users:
    get:
      tags:
        - Admin
      summary: Get all users
      description: Get all users with pagination (admin only)
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        "200":
          description: Users retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      type: object
                  pagination:
                    type: object
  /admin/elders:
    get:
      tags:
        - Admin
      summary: Get all elders
      description: Get all elders with pagination (admin only)
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        "200":
          description: Elders retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      type: object
                  pagination:
                    type: object
  /admin/events:
    get:
      tags:
        - Admin
      summary: Get all events
      description: Get all events with pagination (admin only)
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
        - name: type
          in: query
          schema:
            type: string
            enum: [FALL_DETECTED, HEART_RATE_ABNORMAL, DEVICE_OFFLINE]
      responses:
        "200":
          description: Events retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      type: object
                  pagination:
                    type: object
  /admin/events/stats:
    get:
      tags:
        - Admin
      summary: Get event statistics
      description: Get event statistics (admin only)
      parameters:
        - name: days
          in: query
          schema:
            type: integer
            default: 30
      responses:
        "200":
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      totalFallEvents:
                        type: integer
                      totalHeartRateEvents:
                        type: integer
                      totalDeviceOffline:
                        type: integer
  /feedback:
    post:
      tags:
        - Feedback
      summary: Submit feedback
      description: Submit user feedback
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - message
              properties:
                message:
                  type: string
      responses:
        "201":
          description: Feedback submitted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
    get:
      tags:
        - Feedback
      summary: Get all feedback
      description: Get all feedback (admin only)
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [PENDING, IN_PROGRESS, RESOLVED]
          description: Filter by status
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        "200":
          description: Feedback retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      type: object
                  pagination:
                    type: object
  /feedback/{id}/status:
    patch:
      tags:
        - Feedback
      summary: Update feedback status
      description: Update feedback status (admin only)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  type: string
                  enum: [PENDING, IN_PROGRESS, RESOLVED]
                adminNote:
                  type: string
      responses:
        "200":
          description: Feedback status updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
